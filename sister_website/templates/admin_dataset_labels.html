{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="admin-container">
    <h1>{{ title }}</h1>

    <div class="admin-users-form" style="margin-bottom: 2rem;">
        <h2>Add New Dataset Label</h2>
        <form method="POST" action="{{ url_for('admin_dataset_labels') }}">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ render_field(form.name, attrs={'class': 'form-input'}) }}
            </div>
            <div class="form-group">
                {{ render_field(form.description, attrs={'class': 'form-input', 'rows': 3}) }}
            </div>
            <div class="form-group">
                {{ form.submit(class="btn") }}
            </div>
        </form>
    </div>

    <div class="admin-users-list">
        <h2>Existing Labels</h2>
        <table class="user-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th class="status-column">Status</th>
                    <th class="actions-column">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for label in labels %}
                <tr>
                    <td>{{ label.name }}</td>
                    <td>{{ label.description }}</td>
                    <td class="status-column">
                        <span class="status-badge {{ 'status-accepted' if label.is_active else 'status-declined' }}">
                            {{ 'Active' if label.is_active else 'Inactive' }}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <a href="{{ url_for('edit_dataset_label', label_id=label.id) }}" class="btn btn-sm btn-secondary">Edit</a>
                        <button class="btn btn-sm toggle-active-btn {{ 'btn-warning' if label.is_active else 'btn-success' }}" data-label-id="{{ label.id }}">
                            {{ 'Deactivate' if label.is_active else 'Activate' }}
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" style="text-align: center;">No dataset labels found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const toggleButtons = document.querySelectorAll('.toggle-active-btn');
    toggleButtons.forEach(button => {
        button.addEventListener('click', function () {
            const labelId = this.dataset.labelId;
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            fetch(`/admin/dataset-labels/toggle-active/${labelId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error toggling status: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An unexpected error occurred.');
            });
        });
    });
});
</script>
{% endblock %} 